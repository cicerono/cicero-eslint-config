#!/usr/bin/env node
/* eslint-disable no-console */
const spawn = require("child_process").spawn;
const packageInfo = require("./package.json");

console.log("Installing peer dependencies");

let dependencies = Object.keys(packageInfo.devDependencies)
  .map(dependency => `${dependency}@${packageInfo.devDependencies[dependency]}`);

if (process.argv.indexOf("prettier") === -1) {
  dependencies = dependencies.filter(dependency => !/prettier/.test(dependency));
}

if (process.argv.indexOf("lodash") === -1) {
  dependencies = dependencies.filter(dependency => !/lodash/.test(dependency));
}

if (process.argv.indexOf("base") === -1) {
  dependencies = dependencies.filter(dependency => !/react/.test(dependency));
  dependencies = dependencies.filter(dependency => !/a11y/.test(dependency));
}

const install = spawn("npm", [
  "install",
  "--save-dev",
].concat(dependencies));

install.stdout.on("data", data => console.log(data.toString()));
install.stderr.on("data", data => console.error(data.toString()));

install.on("close", (code) => {
  if (code === 0) {
    console.log("Install was successful âœ¨");
    console.log("If this project is using yarn you will now have to remove package-lock.json and run yarn to update yarn.lock");
  } else {
    console.log(`install failed with exit code ${code}`);
  }
});
